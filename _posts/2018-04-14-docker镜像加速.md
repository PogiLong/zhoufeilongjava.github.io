---
layout: post
title: docker镜像加速
comments: true
categories: technology
---

centeros7 中 docker1.8以上版本的镜像加速配置


首先严厉批评[https://yeasy.gitbooks.io/docker_practice/content/install/mirror.html#ubuntu-1604、debian-8、centos-7](https://yeasy.gitbooks.io/docker_practice/content/install/mirror.html#ubuntu-1604、debian-8、centos-7)
中的说法.
按此配置会报错误:


    ~ systemctl status docker.service
    ● docker.service - Docker Application Container Engine
       Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)
       Active: failed (Result: start-limit) since Sat 2018-04-14 17:34:32 CST; 31s ago
         Docs: https://docs.docker.com
      Process: 12840 ExecStart=/usr/bin/dockerd (code=exited, status=1/FAILURE)
     Main PID: 12840 (code=exited, status=1/FAILURE)
    
    Apr 14 17:34:32 iZbp1eo57jnmoqnbximvxqZ systemd[1]: start request repeated too quickly for docker.service
    Apr 14 17:34:32 iZbp1eo57jnmoqnbximvxqZ systemd[1]: Failed to start Docker Application Container Engine.
    Apr 14 17:34:32 iZbp1eo57jnmoqnbximvxqZ systemd[1]: Unit docker.service entered failed state.
    Apr 14 17:34:32 iZbp1eo57jnmoqnbximvxqZ systemd[1]: docker.service failed.
    Apr 14 17:34:38 iZbp1eo57jnmoqnbximvxqZ systemd[1]: start request repeated too quickly for docker.service
    Apr 14 17:34:38 iZbp1eo57jnmoqnbximvxqZ systemd[1]: Failed to start Docker Application Container Engine.
    Apr 14 17:34:38 iZbp1eo57jnmoqnbximvxqZ systemd[1]: docker.service failed.
    Apr 14 17:34:56 iZbp1eo57jnmoqnbximvxqZ systemd[1]: start request repeated too quickly for docker.service
    Apr 14 17:34:56 iZbp1eo57jnmoqnbximvxqZ systemd[1]: Failed to start Docker Application Container Engine.
    Apr 14 17:34:56 iZbp1eo57jnmoqnbximvxqZ systemd[1]: docker.service failed.
    
    
    
正确方式应是:

    sudo cp -n /lib/systemd/system/docker.service /etc/systemd/system/docker.service
    sudo sed -i "s|ExecStart=/usr/bin/docker daemon|ExecStart=/usr/bin/docker daemon --registry-mirror=<your accelerate address>|g" /etc/systemd/system/docker.service
    sudo sed -i "s|ExecStart=/usr/bin/dockerd|ExecStart=/usr/bin/dockerd --registry-mirror=<your accelerate address>|g" /etc/systemd/system/docker.service
    sudo systemctl daemon-reload
    sudo service docker restart