---
layout: post
title: 记录一次mqtt服务异常
comments: true
categories: technology
---


​​今天mqtt服务异常导致通过mqtt接收消息的打印机无法打印。
重启mqtt服务后用客户端连接服务发现还是连接服务失败，查询进程后发现当前服务cpu占用高达100%。

首先怀疑是程序设计不合理导致，出现bug瞬间打满cpu，
甚至怀疑服务器被黑客SNY攻击，但是通过阿里云系统监控查看tcp连接数，最高峰也不过400多。
但我马上发现磁盘占用率也被打满，在服务器上查找一下大文件，发现mqtt.log占满了磁盘，
那么问题就是mqtt服务运行时间比较久，日志文件积攒太大，马上删除mqtt.log，重启服务，cpu恢复正常，mqtt服务也连接正常。

总结：第一次碰到因磁盘占满导致cpu也飙升，之后也应该多多利用阿里云的监控报警功能，防止此类问题重演。

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>